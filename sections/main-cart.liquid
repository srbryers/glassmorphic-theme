{%- comment -%}
  Main Cart Section

  Full cart page with line items, quantities, and checkout.
  Features glass card styling and enhanced micro-interactions.
{%- endcomment -%}

<section class="section py-8 md:py-12">
  <div class="container">
    <h1 class="text-3xl md:text-4xl font-bold text-[var(--foreground)] mb-8">
      {{ 'cart.title' | t }}
      {%- if cart.item_count > 0 -%}
        <span class="text-lg font-normal text-[var(--muted-foreground)] ml-2">({{ cart.item_count }})</span>
      {%- endif -%}
    </h1>

    {%- if cart.item_count > 0 -%}
      <div class="grid lg:grid-cols-3 gap-8 lg:gap-12">
        {%- comment -%} Cart Items {%- endcomment -%}
        <div class="lg:col-span-2">
          <form action="{{ routes.cart_url }}" method="post" id="cart-form">
            <div class="space-y-4">
              {%- for item in cart.items -%}
                <div
                  class="flex gap-4 p-4 bg-[var(--card)] border border-[var(--border)] rounded-2xl shadow-sm hover:shadow-md transition-all duration-300"
                  data-cart-item="{{ item.key }}"
                >
                  {%- comment -%} Image {%- endcomment -%}
                  <a href="{{ item.url }}" class="flex-shrink-0 w-24 h-24 md:w-28 md:h-28 bg-[var(--muted)] rounded-xl overflow-hidden shadow-sm">
                    {%- if item.image -%}
                      <img
                        src="{{ item.image | image_url: width: 256 }}"
                        alt="{{ item.title }}"
                        class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
                        loading="lazy"
                        width="256"
                        height="256"
                      >
                    {%- endif -%}
                  </a>

                  {%- comment -%} Details {%- endcomment -%}
                  <div class="flex-1 min-w-0">
                    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2">
                      <div>
                        <a href="{{ item.url }}" class="font-medium text-[var(--foreground)] hover:text-[var(--primary)] transition-colors line-clamp-2">
                          {{ item.product.title }}
                        </a>
                        {%- unless item.variant.title == 'Default Title' -%}
                          <p class="text-sm text-[var(--muted-foreground)] mt-0.5">{{ item.variant.title }}</p>
                        {%- endunless -%}
                        {%- if item.selling_plan_allocation -%}
                          <p class="text-xs text-[var(--primary)] mt-1">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                        {%- endif -%}
                      </div>
                      <p class="price text-lg font-bold whitespace-nowrap">{{ item.final_line_price | money }}</p>
                    </div>

                    <div class="flex items-center justify-between mt-4">
                      {%- comment -%} Quantity {%- endcomment -%}
                      {% render 'quantity-selector',
                        name: 'updates[]',
                        id: item.key,
                        value: item.quantity,
                        min: 0
                      %}

                      {%- comment -%} Remove {%- endcomment -%}
                      <button
                        type="button"
                        onclick="window.location.href='{{ routes.cart_change_url }}?id={{ item.key }}&quantity=0'"
                        class="inline-flex items-center gap-1.5 text-sm text-[var(--muted-foreground)] hover:text-[var(--destructive)] transition-colors"
                      >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        {{ 'cart.remove' | t }}
                      </button>
                    </div>

                    {%- comment -%} Line item discounts {%- endcomment -%}
                    {%- if item.line_level_discount_allocations.size > 0 -%}
                      <ul class="mt-3 space-y-1">
                        {%- for discount in item.line_level_discount_allocations -%}
                          <li class="inline-flex items-center gap-1 text-xs text-[var(--success)] bg-[var(--success)]/10 px-2 py-1 rounded-full">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                            </svg>
                            {{ discount.discount_application.title }} (-{{ discount.amount | money }})
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                </div>
              {%- endfor -%}
            </div>

            {%- comment -%} Update Button {%- endcomment -%}
            <div class="flex justify-end mt-6">
              <button type="submit" name="update" class="btn-outline">
                {{ 'cart.update_cart' | t }}
              </button>
            </div>
          </form>
        </div>

        {%- comment -%} Cart Summary with glass card {%- endcomment -%}
        <div class="lg:col-span-1">
          <div class="sticky top-24 bg-[var(--card)] border border-[var(--border)] rounded-2xl p-6 shadow-sm">
            <h2 class="text-lg font-bold text-[var(--foreground)] mb-5">{{ 'cart.order_summary' | t }}</h2>

            <div class="space-y-3 mb-6">
              <div class="flex items-center justify-between text-sm">
                <span class="text-[var(--muted-foreground)]">{{ 'cart.subtotal' | t }}</span>
                <span class="text-[var(--foreground)] font-medium">{{ cart.items_subtotal_price | money }}</span>
              </div>

              {%- if cart.cart_level_discount_applications.size > 0 -%}
                {%- for discount in cart.cart_level_discount_applications -%}
                  <div class="flex items-center justify-between text-sm">
                    <span class="inline-flex items-center gap-1 text-[var(--success)]">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                      </svg>
                      {{ discount.title }}
                    </span>
                    <span class="text-[var(--success)] font-medium">-{{ discount.total_allocated_amount | money }}</span>
                  </div>
                {%- endfor -%}
              {%- endif -%}

              <div class="flex items-center justify-between text-sm">
                <span class="text-[var(--muted-foreground)]">{{ 'cart.shipping' | t }}</span>
                <span class="text-[var(--muted-foreground)] text-xs">{{ 'cart.shipping_at_checkout' | t }}</span>
              </div>
            </div>

            <div class="flex items-center justify-between py-4 border-t border-[var(--border)]">
              <span class="text-lg font-bold text-[var(--foreground)]">{{ 'cart.total' | t }}</span>
              <span class="text-xl font-bold text-[var(--foreground)]">{{ cart.total_price | money }}</span>
            </div>

            {%- comment -%} Cart Note {%- endcomment -%}
            {%- if section.settings.show_cart_note -%}
              <div class="form-field mt-4">
                <label for="cart-note" class="label text-sm">{{ 'cart.note_label' | t }}</label>
                <textarea
                  id="cart-note"
                  name="note"
                  form="cart-form"
                  class="textarea text-sm"
                  placeholder="{{ 'cart.note_placeholder' | t }}"
                  rows="3"
                >{{ cart.note }}</textarea>
              </div>
            {%- endif -%}

            {%- comment -%} Checkout Button {%- endcomment -%}
            <a href="/checkout" class="btn-primary w-full justify-center mt-6">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              {{ 'cart.checkout' | t }}
            </a>

            <a href="{{ routes.all_products_collection_url }}" class="btn-ghost w-full justify-center mt-2">
              {{ 'cart.continue_shopping' | t }}
            </a>

            {%- comment -%} Trust badges {%- endcomment -%}
            <div class="flex items-center justify-center gap-6 mt-6 pt-6 border-t border-[var(--border)]">
              <div class="flex items-center gap-2 text-xs text-[var(--muted-foreground)]">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
                {{ 'cart.secure_checkout' | t }}
              </div>
              <div class="flex items-center gap-2 text-xs text-[var(--muted-foreground)]">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                {{ 'cart.payment_methods' | t | default: 'All cards accepted' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    {%- else -%}
      {%- comment -%} Empty Cart with glass card {%- endcomment -%}
      <div class="max-w-md mx-auto text-center py-16 md:py-24">
        <div class="inline-flex items-center justify-center w-24 h-24 rounded-3xl bg-[var(--muted)] mb-8">
          <svg class="w-12 h-12 text-[var(--muted-foreground)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
        </div>
        <h2 class="text-2xl font-bold text-[var(--foreground)] mb-3">{{ 'cart.empty' | t }}</h2>
        <p class="text-[var(--muted-foreground)] mb-8 leading-relaxed">{{ 'cart.empty_description' | t }}</p>
        <a href="{{ routes.all_products_collection_url }}" class="btn-primary">
          {{ 'cart.start_shopping' | t }}
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
          </svg>
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Cart",
  "tag": "section",
  "class": "section-main-cart",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_cart_note",
      "label": "Show cart note",
      "default": true
    }
  ]
}
{% endschema %}
