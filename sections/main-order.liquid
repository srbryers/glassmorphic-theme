{%- comment -%}
  Customer Order Section
  Renders individual order details.
{%- endcomment -%}

<div class="customer-order py-12 md:py-20">
  <div class="container max-w-4xl mx-auto px-4">
    <div class="mb-8">
      <a href="{{ routes.account_url }}" class="inline-flex items-center gap-2 text-[var(--muted-foreground)] hover:text-[var(--foreground)] mb-4">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        {{ 'customer.order.back_to_account' | t }}
      </a>
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="font-heading text-3xl md:text-4xl font-bold">
            {{ 'customer.order.title' | t: name: order.name }}
          </h1>
          <p class="text-[var(--muted-foreground)] mt-1">
            {{ 'customer.order.placed_on' | t: date: order.created_at | date: format: 'abbreviated_date' }}
          </p>
        </div>
        {%- if order.cancelled -%}
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 self-start">
            {{ 'customer.order.cancelled' | t }} - {{ order.cancelled_at | date: format: 'abbreviated_date' }}
          </span>
        {%- endif -%}
      </div>
    </div>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
      <div class="glass rounded-xl p-6">
        <h3 class="text-sm font-medium text-[var(--muted-foreground)] uppercase tracking-wider mb-3">
          {{ 'customer.order.payment_status' | t }}
        </h3>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium
          {%- if order.financial_status == 'paid' %} bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400
          {%- elsif order.financial_status == 'pending' %} bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400
          {%- else %} bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400
          {%- endif -%}">
          {{ order.financial_status_label }}
        </span>
      </div>

      <div class="glass rounded-xl p-6">
        <h3 class="text-sm font-medium text-[var(--muted-foreground)] uppercase tracking-wider mb-3">
          {{ 'customer.order.fulfillment_status' | t }}
        </h3>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium
          {%- if order.fulfillment_status == 'fulfilled' %} bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400
          {%- elsif order.fulfillment_status == 'partial' %} bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400
          {%- else %} bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400
          {%- endif -%}">
          {{ order.fulfillment_status_label | default: 'Unfulfilled' }}
        </span>
      </div>

      <div class="glass rounded-xl p-6">
        <h3 class="text-sm font-medium text-[var(--muted-foreground)] uppercase tracking-wider mb-3">
          {{ 'customer.order.total' | t }}
        </h3>
        <span class="text-xl font-bold">{{ order.total_price | money }}</span>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="glass rounded-xl p-6">
        <h3 class="font-medium mb-4">{{ 'customer.order.shipping_address' | t }}</h3>
        <address class="text-[var(--muted-foreground)] not-italic">
          {{ order.shipping_address | format_address }}
        </address>
      </div>

      <div class="glass rounded-xl p-6">
        <h3 class="font-medium mb-4">{{ 'customer.order.billing_address' | t }}</h3>
        <address class="text-[var(--muted-foreground)] not-italic">
          {{ order.billing_address | format_address }}
        </address>
      </div>
    </div>

    <div class="glass rounded-2xl overflow-hidden mb-8">
      <div class="p-6 border-b border-[var(--border)]">
        <h2 class="font-heading text-xl font-bold">{{ 'customer.order.items' | t }}</h2>
      </div>

      <div class="divide-y divide-[var(--border)]">
        {%- for line_item in order.line_items -%}
          <div class="p-6 flex gap-4">
            <div class="w-20 h-20 rounded-lg bg-[var(--muted)] overflow-hidden flex-shrink-0">
              {%- if line_item.image -%}
                <img
                  src="{{ line_item.image | image_url: width: 160 }}"
                  alt="{{ line_item.title }}"
                  class="w-full h-full object-cover"
                  width="80"
                  height="80"
                  loading="lazy"
                >
              {%- endif -%}
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="font-medium">
                {%- if line_item.product.url != blank -%}
                  <a href="{{ line_item.product.url }}" class="hover:text-[var(--primary)]">
                    {{ line_item.title }}
                  </a>
                {%- else -%}
                  {{ line_item.title }}
                {%- endif -%}
              </h3>
              {%- if line_item.variant.title != 'Default Title' -%}
                <p class="text-sm text-[var(--muted-foreground)]">{{ line_item.variant.title }}</p>
              {%- endif -%}
              {%- if line_item.selling_plan_allocation -%}
                <p class="text-sm text-[var(--muted-foreground)]">{{ line_item.selling_plan_allocation.selling_plan.name }}</p>
              {%- endif -%}
              <p class="text-sm text-[var(--muted-foreground)] mt-1">
                {{ 'customer.order.quantity' | t }}: {{ line_item.quantity }}
              </p>
            </div>
            <div class="text-right">
              <p class="font-medium">{{ line_item.final_line_price | money }}</p>
              {%- if line_item.original_line_price != line_item.final_line_price -%}
                <p class="text-sm text-[var(--muted-foreground)] line-through">{{ line_item.original_line_price | money }}</p>
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
      </div>

      <div class="p-6 bg-[var(--muted)]/30 space-y-2">
        <div class="flex justify-between">
          <span class="text-[var(--muted-foreground)]">{{ 'customer.order.subtotal' | t }}</span>
          <span>{{ order.subtotal_price | money }}</span>
        </div>

        {%- for discount_application in order.discount_applications -%}
          <div class="flex justify-between text-green-600 dark:text-green-400">
            <span>{{ discount_application.title }}</span>
            <span>-{{ discount_application.total_allocated_amount | money }}</span>
          </div>
        {%- endfor -%}

        {%- for shipping_method in order.shipping_methods -%}
          <div class="flex justify-between">
            <span class="text-[var(--muted-foreground)]">{{ 'customer.order.shipping' | t }} ({{ shipping_method.title }})</span>
            <span>{{ shipping_method.price | money }}</span>
          </div>
        {%- endfor -%}

        {%- for tax_line in order.tax_lines -%}
          <div class="flex justify-between">
            <span class="text-[var(--muted-foreground)]">{{ tax_line.title }}</span>
            <span>{{ tax_line.price | money }}</span>
          </div>
        {%- endfor -%}

        <div class="flex justify-between pt-2 border-t border-[var(--border)] font-bold text-lg">
          <span>{{ 'customer.order.total' | t }}</span>
          <span>{{ order.total_price | money }}</span>
        </div>
      </div>
    </div>

    {%- if order.fulfillments.size > 0 -%}
      <div class="glass rounded-2xl overflow-hidden">
        <div class="p-6 border-b border-[var(--border)]">
          <h2 class="font-heading text-xl font-bold">{{ 'customer.order.tracking' | t }}</h2>
        </div>
        <div class="p-6 space-y-4">
          {%- for fulfillment in order.fulfillments -%}
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium">{{ fulfillment.tracking_company }}</p>
                <p class="text-sm text-[var(--muted-foreground)]">{{ fulfillment.tracking_number }}</p>
              </div>
              {%- if fulfillment.tracking_url -%}
                <a href="{{ fulfillment.tracking_url }}" target="_blank" rel="noopener" class="btn btn-outline btn-sm">
                  {{ 'customer.order.track_shipment' | t }}
                </a>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Customer Order",
  "tag": "section",
  "class": "section-customer-order",
  "settings": []
}
{% endschema %}
