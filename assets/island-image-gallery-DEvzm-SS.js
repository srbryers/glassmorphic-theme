var g=Object.defineProperty;var p=(m,r,t)=>r in m?g(m,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[r]=t;var s=(m,r,t)=>p(m,typeof r!="symbol"?r+"":r,t);class v extends HTMLElement{constructor(){super(...arguments);s(this,"mainImage",null);s(this,"thumbnails",null);s(this,"prevButton",null);s(this,"nextButton",null);s(this,"images",[]);s(this,"currentIndex",0);s(this,"touchStartX",0);s(this,"touchEndX",0);s(this,"wrapper",null);s(this,"imageContainer",null);s(this,"zoomLens",null);s(this,"zoomResult",null);s(this,"isZoomEnabled",!1)}connectedCallback(){var t;console.log("[Island] image-gallery hydrated (client:visible)"),this.mainImage=this.querySelector("[data-main-image]"),this.thumbnails=this.querySelectorAll("[data-thumbnail]"),this.prevButton=this.querySelector("[data-prev]"),this.nextButton=this.querySelector("[data-next]"),this.wrapper=this.closest('[data-island="image-gallery"]'),this.imageContainer=this.querySelector("[data-image-container]"),this.zoomLens=this.querySelector("[data-zoom-lens]"),this.zoomResult=((t=this.wrapper)==null?void 0:t.querySelector("[data-zoom-result]"))||null,this.loadImages(),this.setupEventListeners(),this.initZoom(),this.updateUI(),this.setAttribute("data-hydrated","true")}loadImages(){var n;(n=this.thumbnails)==null||n.forEach((o,h)=>{const a=o.querySelector("img");a&&this.images.push({src:o.dataset.fullSrc||a.src,alt:a.alt,thumbnail:a.src})});const t=new URLSearchParams(window.location.search),e=parseInt(t.get("image")||"0");e>=0&&e<this.images.length&&(this.currentIndex=e)}setupEventListeners(){var t,e,n,o,h,a,l,d;(t=this.thumbnails)==null||t.forEach((i,u)=>{i.addEventListener("click",()=>{this.goTo(u)}),i.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),this.goTo(u))})}),(e=this.prevButton)==null||e.addEventListener("click",()=>this.prev()),(n=this.nextButton)==null||n.addEventListener("click",()=>this.next()),(h=(o=this.mainImage)==null?void 0:o.parentElement)==null||h.addEventListener("touchstart",i=>{this.touchStartX=i.touches[0].clientX},{passive:!0}),(l=(a=this.mainImage)==null?void 0:a.parentElement)==null||l.addEventListener("touchend",i=>{this.touchEndX=i.changedTouches[0].clientX,this.handleSwipe()},{passive:!0}),this.addEventListener("keydown",i=>{i.key==="ArrowLeft"?this.prev():i.key==="ArrowRight"&&this.next()}),document.addEventListener("variant:image-change",(i=>{this.handleVariantChange(i.detail)})),document.addEventListener("lightbox:change",(i=>{i.detail.index!==void 0&&this.goTo(i.detail.index)})),(d=this.mainImage)==null||d.addEventListener("click",()=>{this.openZoom()})}handleSwipe(){const e=this.touchStartX-this.touchEndX;Math.abs(e)>50&&(e>0?this.next():this.prev())}handleVariantChange(t){const e=this.images.findIndex(n=>n.src===t.src);e>=0?this.goTo(e):this.mainImage&&(this.mainImage.src=t.src,this.mainImage.alt=t.alt)}goTo(t){t<0||t>=this.images.length||t!==this.currentIndex&&(this.currentIndex=t,this.updateUI(),this.dispatchEvent(new CustomEvent("gallery:change",{bubbles:!0,detail:{index:t,image:this.images[t]}})))}prev(){const t=this.currentIndex>0?this.currentIndex-1:this.images.length-1;this.goTo(t)}next(){const t=this.currentIndex<this.images.length-1?this.currentIndex+1:0;this.goTo(t)}updateUI(){var e,n,o;const t=this.images[this.currentIndex];t&&(this.mainImage&&(this.mainImage.classList.add("opacity-0"),setTimeout(()=>{this.mainImage&&(this.mainImage.src=t.src,this.mainImage.alt=t.alt,this.mainImage.classList.remove("opacity-0"),this.updateZoomBackground())},150)),(e=this.thumbnails)==null||e.forEach((h,a)=>{const l=a===this.currentIndex;h.classList.toggle("ring-2",l),h.classList.toggle("ring-[var(--primary)]",l),h.setAttribute("aria-selected",l.toString())}),(n=this.prevButton)==null||n.classList.toggle("opacity-50",this.currentIndex===0),(o=this.nextButton)==null||o.classList.toggle("opacity-50",this.currentIndex===this.images.length-1))}openZoom(){this.images.length!==0&&document.dispatchEvent(new CustomEvent("modal:open",{detail:{id:"image-zoom",images:this.images,currentIndex:this.currentIndex}}))}initZoom(){const t=window.matchMedia("(min-width: 1024px)");this.isZoomEnabled=t.matches,t.addEventListener("change",e=>{this.isZoomEnabled=e.matches,e.matches||this.hideZoom()}),!(!this.imageContainer||!this.zoomLens||!this.zoomResult)&&(this.imageContainer.addEventListener("mouseenter",()=>this.showZoom()),this.imageContainer.addEventListener("mouseleave",()=>this.hideZoom()),this.imageContainer.addEventListener("mousemove",e=>this.handleZoomMove(e)),this.updateZoomBackground())}showZoom(){!this.isZoomEnabled||!this.wrapper||this.wrapper.classList.add("zoom-active")}hideZoom(){this.wrapper&&this.wrapper.classList.remove("zoom-active")}handleZoomMove(t){if(!this.isZoomEnabled||!this.imageContainer||!this.zoomLens||!this.zoomResult)return;const e=this.imageContainer.getBoundingClientRect(),n=(t.clientX-e.left)/e.width*100,o=(t.clientY-e.top)/e.height*100,h=Math.max(0,Math.min(100,n)),a=Math.max(0,Math.min(100,o));this.zoomLens.style.left=`${h}%`,this.zoomLens.style.top=`${a}%`,this.zoomResult.style.backgroundPosition=`${h}% ${a}%`}updateZoomBackground(){!this.zoomResult||!this.mainImage||(this.zoomResult.style.backgroundImage=`url('${this.mainImage.src}')`)}}customElements.define("image-gallery",v);
