var u=Object.defineProperty;var h=(l,o,t)=>o in l?u(l,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[o]=t;var s=(l,o,t)=>h(l,typeof o!="symbol"?o+"":o,t);import{c as p,a as f}from"./island-cart-drawer-BXBOsEp0.js";class v extends HTMLElement{constructor(){super(...arguments);s(this,"form",null);s(this,"variantSelect",null);s(this,"optionInputs",null);s(this,"priceElement",null);s(this,"comparePriceElement",null);s(this,"addButton",null);s(this,"quantityInput",null);s(this,"productData",null);s(this,"currentVariant",null)}connectedCallback(){console.log("[Island] product-form hydrated (client:visible)"),this.form=this.querySelector("form"),this.variantSelect=this.querySelector("[data-variant-select]"),this.optionInputs=this.querySelectorAll("[data-option-input]"),this.priceElement=this.querySelector("[data-price]"),this.comparePriceElement=this.querySelector("[data-compare-price]"),this.addButton=this.querySelector("[data-add-button]"),this.quantityInput=this.querySelector("[data-quantity-input]"),this.loadProductData(),this.setupEventListeners(),this.setAttribute("data-hydrated","true")}loadProductData(){const t=this.querySelector("[data-product-json]");if(t)try{this.productData=JSON.parse(t.textContent||"{}"),this.updateCurrentVariant()}catch(a){console.error("Failed to parse product data:",a)}}setupEventListeners(){var e,i,r;(e=this.variantSelect)==null||e.addEventListener("change",()=>{this.updateCurrentVariant()}),(i=this.optionInputs)==null||i.forEach(n=>{n.addEventListener("change",()=>{this.updateVariantFromOptions()})});const t=this.querySelector("[data-quantity-decrement]"),a=this.querySelector("[data-quantity-increment]");t==null||t.addEventListener("click",()=>{if(this.quantityInput){const n=parseInt(this.quantityInput.value)||1;n>1&&(this.quantityInput.value=(n-1).toString())}}),a==null||a.addEventListener("click",()=>{if(this.quantityInput){const n=parseInt(this.quantityInput.value)||1;this.quantityInput.value=(n+1).toString()}}),(r=this.form)==null||r.addEventListener("submit",n=>{n.preventDefault(),this.handleAddToCart()})}updateCurrentVariant(){if(!this.productData)return;const t=this.variantSelect?parseInt(this.variantSelect.value):this.getVariantFromOptions();this.currentVariant=this.productData.variants.find(a=>a.id===t)||null,this.updateUI(),this.updateURL()}updateVariantFromOptions(){if(!this.productData||!this.optionInputs)return;const t=[];this.optionInputs.forEach(e=>{e.checked&&(t[parseInt(e.dataset.optionIndex||"0")]=e.value)});const a=this.productData.variants.find(e=>e.options.every((i,r)=>i===t[r]));a&&this.variantSelect&&(this.variantSelect.value=a.id.toString()),this.currentVariant=a||null,this.updateUI(),this.updateURL()}getVariantFromOptions(){if(!this.productData||!this.optionInputs)return null;const t=[];this.optionInputs.forEach(e=>{e.checked&&(t[parseInt(e.dataset.optionIndex||"0")]=e.value)});const a=this.productData.variants.find(e=>e.options.every((i,r)=>i===t[r]));return(a==null?void 0:a.id)||null}updateUI(){var t,a,e;if(!this.currentVariant){this.addButton&&(this.addButton.disabled=!0,this.addButton.textContent="Unavailable");return}this.priceElement&&(this.priceElement.textContent=this.formatMoney(this.currentVariant.price)),this.comparePriceElement&&(this.currentVariant.compare_at_price&&this.currentVariant.compare_at_price>this.currentVariant.price?(this.comparePriceElement.textContent=this.formatMoney(this.currentVariant.compare_at_price),this.comparePriceElement.classList.remove("hidden"),(t=this.priceElement)==null||t.classList.add("price-sale")):(this.comparePriceElement.classList.add("hidden"),(a=this.priceElement)==null||a.classList.remove("price-sale"))),this.addButton&&(this.addButton.disabled=!this.currentVariant.available,this.addButton.textContent=this.currentVariant.available?"Add to Cart":"Sold Out"),this.currentVariant.featured_image&&this.dispatchEvent(new CustomEvent("variant:image-change",{bubbles:!0,detail:{src:this.currentVariant.featured_image.src,alt:this.currentVariant.featured_image.alt}})),(e=this.optionInputs)==null||e.forEach(i=>{var c,d;const r=parseInt(i.dataset.optionIndex||"0"),n=i.value===((c=this.currentVariant)==null?void 0:c.options[r]);i.checked=n,(d=i.closest("label"))==null||d.classList.toggle("selected",n)}),this.updateStockDisplay()}updateStockDisplay(){const t=this.querySelector("[data-stock-display]");if(!t||!this.currentVariant)return;const a=t.dataset.style||"count",e=parseInt(t.dataset.threshold||"5",10),i=this.currentVariant.inventory_quantity||0,r=this.currentVariant.available,n=this.currentVariant.inventory_policy==="continue";let c="";r&&(i<=0&&n?c='<span class="stock-level--backorder">Available for backorder</span>':a==="count"?i<=e?c=`<span class="stock-level--low">Only ${i} left</span>`:c=`<span class="stock-level--in-stock">${i} in stock</span>`:i<=e&&(c=`<span class="stock-level--low">Only ${i} left</span>`)),t.innerHTML=c}updateURL(){if(!this.currentVariant)return;const t=new URL(window.location.href);t.searchParams.set("variant",this.currentVariant.id.toString()),window.history.replaceState({},"",t.toString())}async handleAddToCart(){var a;if(!this.currentVariant||!this.currentVariant.available)return;const t=parseInt(((a=this.quantityInput)==null?void 0:a.value)||"1");this.addButton&&(this.addButton.disabled=!0,this.addButton.innerHTML=`
        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 inline" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Adding...
      `);try{await p.addItem(this.currentVariant.id,t),this.addButton&&(this.addButton.innerHTML=`
          <svg class="w-5 h-5 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          Added!
        `,document.dispatchEvent(new CustomEvent("cart:open")),setTimeout(()=>{var e;this.addButton&&((e=this.currentVariant)!=null&&e.available)&&(this.addButton.disabled=!1,this.addButton.textContent="Add to Cart")},2e3))}catch(e){console.error("Add to cart failed:",e),this.addButton&&(this.addButton.disabled=!1,this.addButton.textContent="Error - Try Again",setTimeout(()=>{var i;this.addButton&&((i=this.currentVariant)!=null&&i.available)&&(this.addButton.textContent="Add to Cart")},2e3))}}formatMoney(t){return f.formatMoney(t)}}customElements.define("product-form",v);
