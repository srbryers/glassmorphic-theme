var d=Object.defineProperty;var o=(a,l,e)=>l in a?d(a,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[l]=e;var i=(a,l,e)=>o(a,typeof l!="symbol"?l+"":l,e);class n extends HTMLElement{constructor(){super(...arguments);i(this,"dialog",null);i(this,"overlay",null);i(this,"closeButtons",null);i(this,"focusableElements",[]);i(this,"previouslyFocused",null);i(this,"isOpen",!1);i(this,"modalId",null);i(this,"handleKeydown",e=>{if(this.isOpen){if(e.key==="Escape"){this.close();return}e.key==="Tab"&&this.handleTabKey(e)}})}connectedCallback(){console.log("[Island] modal hydrated (client:idle)"),this.modalId=this.getAttribute("data-modal-id"),this.dialog=this.querySelector("[data-modal-dialog]"),this.overlay=this.querySelector("[data-modal-overlay]"),this.closeButtons=this.querySelectorAll("[data-modal-close]"),this.setupEventListeners(),this.setupGlobalTriggers(),this.setAttribute("data-hydrated","true")}disconnectedCallback(){document.removeEventListener("keydown",this.handleKeydown)}setupEventListeners(){var e,t;(e=this.closeButtons)==null||e.forEach(s=>{s.addEventListener("click",()=>this.close())}),(t=this.overlay)==null||t.addEventListener("click",()=>this.close()),this.handleKeydown=this.handleKeydown.bind(this),document.addEventListener("keydown",this.handleKeydown)}setupGlobalTriggers(){this.modalId&&(document.addEventListener("click",e=>{e.target.closest(`[data-modal-trigger="${this.modalId}"]`)&&(e.preventDefault(),this.open())}),document.addEventListener("modal:open",(e=>{var t;((t=e.detail)==null?void 0:t.id)===this.modalId&&this.open()})),document.addEventListener("modal:close",(e=>{var t,s;(((t=e.detail)==null?void 0:t.id)===this.modalId||!((s=e.detail)!=null&&s.id))&&this.close()})))}handleTabKey(e){if(this.updateFocusableElements(),this.focusableElements.length===0)return;const t=this.focusableElements[0],s=this.focusableElements[this.focusableElements.length-1];e.shiftKey?document.activeElement===t&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),t.focus())}updateFocusableElements(){if(!this.dialog)return;const e=["button:not([disabled])","a[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");this.focusableElements=Array.from(this.dialog.querySelectorAll(e))}open(){!this.dialog||!this.overlay||this.isOpen||(this.isOpen=!0,this.previouslyFocused=document.activeElement,this.classList.remove("hidden"),this.overlay.classList.remove("hidden","opacity-0"),this.dialog.classList.remove("hidden","opacity-0","scale-95"),requestAnimationFrame(()=>{var e,t;(e=this.overlay)==null||e.classList.add("opacity-100"),(t=this.dialog)==null||t.classList.add("opacity-100","scale-100")}),document.body.style.overflow="hidden",this.updateFocusableElements(),this.focusableElements.length>0&&setTimeout(()=>{var e;(e=this.focusableElements[0])==null||e.focus()},100),this.dispatchEvent(new CustomEvent("modal:opened",{bubbles:!0,detail:{id:this.modalId}})))}close(){var e;!this.dialog||!this.overlay||this.isOpen&&(this.isOpen=!1,this.overlay.classList.remove("opacity-100"),this.overlay.classList.add("opacity-0"),this.dialog.classList.remove("opacity-100","scale-100"),this.dialog.classList.add("opacity-0","scale-95"),document.body.style.overflow="",setTimeout(()=>{var t,s;this.isOpen||(this.classList.add("hidden"),(t=this.overlay)==null||t.classList.add("hidden"),(s=this.dialog)==null||s.classList.add("hidden"))},200),(e=this.previouslyFocused)==null||e.focus(),this.dispatchEvent(new CustomEvent("modal:closed",{bubbles:!0,detail:{id:this.modalId}})))}}customElements.define("modal-island",n);
