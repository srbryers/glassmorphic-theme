var g=Object.defineProperty;var v=(l,h,t)=>h in l?g(l,h,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[h]=t;var n=(l,h,t)=>v(l,typeof h!="symbol"?h+"":h,t);class p extends HTMLElement{constructor(){super(...arguments);n(this,"mainImage",null);n(this,"thumbnails",null);n(this,"prevButton",null);n(this,"nextButton",null);n(this,"images",[]);n(this,"currentIndex",0);n(this,"touchStartX",0);n(this,"touchEndX",0);n(this,"wrapper",null);n(this,"imageContainer",null);n(this,"zoomLens",null);n(this,"zoomResult",null);n(this,"isZoomEnabled",!1);n(this,"isOverNavigation",!1)}connectedCallback(){var t;console.log("[Island] image-gallery hydrated (client:visible)"),this.mainImage=this.querySelector("[data-main-image]"),this.thumbnails=this.querySelectorAll("[data-thumbnail]"),this.prevButton=this.querySelector("[data-prev]"),this.nextButton=this.querySelector("[data-next]"),this.wrapper=this.closest('[data-island="image-gallery"]'),this.imageContainer=this.querySelector("[data-image-container]"),this.zoomLens=this.querySelector("[data-zoom-lens]"),this.zoomResult=((t=this.wrapper)==null?void 0:t.querySelector("[data-zoom-result]"))||null,this.loadImages(),this.setupEventListeners(),this.initZoom(),this.updateUI(),this.setAttribute("data-hydrated","true")}loadImages(){var s;(s=this.thumbnails)==null||s.forEach((o,r)=>{const i=o.querySelector("img");i&&this.images.push({src:o.dataset.fullSrc||i.src,alt:i.alt,thumbnail:i.src})});const t=new URLSearchParams(window.location.search),e=parseInt(t.get("image")||"0");e>=0&&e<this.images.length&&(this.currentIndex=e)}setupEventListeners(){var t,e,s,o,r,i,m,c;(t=this.thumbnails)==null||t.forEach((a,u)=>{a.addEventListener("click",()=>{this.goTo(u)}),a.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),this.goTo(u))})}),(e=this.prevButton)==null||e.addEventListener("click",()=>this.prev()),(s=this.nextButton)==null||s.addEventListener("click",()=>this.next()),(r=(o=this.mainImage)==null?void 0:o.parentElement)==null||r.addEventListener("touchstart",a=>{this.touchStartX=a.touches[0].clientX},{passive:!0}),(m=(i=this.mainImage)==null?void 0:i.parentElement)==null||m.addEventListener("touchend",a=>{this.touchEndX=a.changedTouches[0].clientX,this.handleSwipe()},{passive:!0}),this.addEventListener("keydown",a=>{a.key==="ArrowLeft"?this.prev():a.key==="ArrowRight"&&this.next()}),document.addEventListener("variant:image-change",(a=>{this.handleVariantChange(a.detail)})),document.addEventListener("lightbox:change",(a=>{a.detail.index!==void 0&&this.goTo(a.detail.index)})),(c=this.mainImage)==null||c.addEventListener("click",()=>{this.openZoom()})}handleSwipe(){const e=this.touchStartX-this.touchEndX;Math.abs(e)>50&&(e>0?this.next():this.prev())}handleVariantChange(t){const e=this.images.findIndex(s=>s.src===t.src);e>=0?this.goTo(e):this.mainImage&&(this.mainImage.src=t.src,this.mainImage.alt=t.alt)}goTo(t){t<0||t>=this.images.length||t!==this.currentIndex&&(this.currentIndex=t,this.updateUI(),this.dispatchEvent(new CustomEvent("gallery:change",{bubbles:!0,detail:{index:t,image:this.images[t]}})))}prev(){const t=this.currentIndex>0?this.currentIndex-1:this.images.length-1;this.goTo(t)}next(){const t=this.currentIndex<this.images.length-1?this.currentIndex+1:0;this.goTo(t)}updateUI(){var e,s,o;const t=this.images[this.currentIndex];t&&(this.mainImage&&(this.mainImage.classList.add("opacity-0"),setTimeout(()=>{this.mainImage&&(this.mainImage.src=t.src,this.mainImage.alt=t.alt,this.mainImage.classList.remove("opacity-0"),this.updateZoomBackground())},150)),(e=this.thumbnails)==null||e.forEach((r,i)=>{const m=i===this.currentIndex;r.classList.toggle("ring-2",m),r.classList.toggle("ring-[var(--primary)]",m),r.setAttribute("aria-selected",m.toString())}),(s=this.prevButton)==null||s.classList.toggle("opacity-50",this.currentIndex===0),(o=this.nextButton)==null||o.classList.toggle("opacity-50",this.currentIndex===this.images.length-1))}openZoom(){this.images.length!==0&&document.dispatchEvent(new CustomEvent("modal:open",{detail:{id:"image-zoom",images:this.images,currentIndex:this.currentIndex}}))}initZoom(){var e,s,o,r;const t=window.matchMedia("(min-width: 1024px)");this.isZoomEnabled=t.matches,t.addEventListener("change",i=>{this.isZoomEnabled=i.matches,i.matches||this.hideZoom()}),!(!this.imageContainer||!this.zoomLens||!this.zoomResult)&&(this.imageContainer.addEventListener("mouseenter",()=>this.showZoom()),this.imageContainer.addEventListener("mouseleave",()=>this.hideZoom()),this.imageContainer.addEventListener("mousemove",i=>this.handleZoomMove(i)),console.log("[Zoom] prevButton:",this.prevButton),console.log("[Zoom] nextButton:",this.nextButton),(e=this.prevButton)==null||e.addEventListener("mouseenter",()=>{console.log("[Zoom] mouseenter prevButton"),this.isOverNavigation=!0,this.hideZoom()}),(s=this.nextButton)==null||s.addEventListener("mouseenter",()=>{console.log("[Zoom] mouseenter nextButton"),this.isOverNavigation=!0,this.hideZoom()}),(o=this.prevButton)==null||o.addEventListener("mouseleave",()=>{console.log("[Zoom] mouseleave prevButton"),this.isOverNavigation=!1}),(r=this.nextButton)==null||r.addEventListener("mouseleave",()=>{console.log("[Zoom] mouseleave nextButton"),this.isOverNavigation=!1}),this.updateZoomBackground())}showZoom(){!this.isZoomEnabled||!this.wrapper||this.isOverNavigation||this.wrapper.classList.add("zoom-active")}hideZoom(){this.wrapper&&this.wrapper.classList.remove("zoom-active")}handleZoomMove(t){if(!this.isZoomEnabled||!this.imageContainer||!this.zoomLens||!this.zoomResult||this.isOverNavigation)return;const e=this.imageContainer.getBoundingClientRect(),s=(t.clientX-e.left)/e.width*100,o=(t.clientY-e.top)/e.height*100,r=Math.max(0,Math.min(100,s)),i=Math.max(0,Math.min(100,o));this.zoomLens.style.left=`${r}%`,this.zoomLens.style.top=`${i}%`,this.zoomResult.style.backgroundPosition=`${r}% ${i}%`}updateZoomBackground(){!this.zoomResult||!this.mainImage||(this.zoomResult.style.backgroundImage=`url('${this.mainImage.src}')`)}}customElements.define("image-gallery",p);
