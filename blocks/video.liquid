
<div
  class="block-video"
  style="--video-radius: {{ block.settings.border_radius }}px; --video-aspect: {{ block.settings.aspect_ratio }};"
  {{ block.shopify_attributes }}
>
  {%- if block.settings.video != blank -%}
    {{
      block.settings.video
      | video_tag:
        autoplay: block.settings.autoplay,
        loop: block.settings.loop,
        muted: block.settings.autoplay,
        controls: block.settings.show_controls,
        playsinline: true,
        poster: block.settings.cover_image,
        class: 'block-video__player'
    }}
  {%- elsif block.settings.video_url != blank -%}
    {%- if block.settings.video_url.type == 'youtube' -%}
      <iframe
        class="block-video__player"
        src="https://www.youtube.com/embed/{{ block.settings.video_url.id }}{% if block.settings.autoplay %}?autoplay=1&mute=1{% endif %}{% if block.settings.loop %}&loop=1&playlist={{ block.settings.video_url.id }}{% endif %}"
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen
        loading="lazy"
      ></iframe>
    {%- elsif block.settings.video_url.type == 'vimeo' -%}
      <iframe
        class="block-video__player"
        src="https://player.vimeo.com/video/{{ block.settings.video_url.id }}{% if block.settings.autoplay %}?autoplay=1&muted=1{% endif %}{% if block.settings.loop %}&loop=1{% endif %}"
        frameborder="0"
        allow="autoplay; encrypted-media"
        allowfullscreen
        loading="lazy"
      ></iframe>
    {%- endif -%}
  {%- else -%}
    <div class="block-video__placeholder">
      <svg class="block-video__placeholder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <polygon points="5 3 19 12 5 21 5 3"></polygon>
      </svg>
    </div>
  {%- endif -%}
</div>

{% stylesheet %}
.block-video {
  position: relative;
  width: 100%;
  aspect-ratio: var(--video-aspect, 16/9);
  border-radius: var(--video-radius, 0);
  overflow: hidden;
  background: var(--muted);
}

.block-video__player {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.block-video__placeholder {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--muted);
}

.block-video__placeholder-icon {
  width: 48px;
  height: 48px;
  opacity: 0.5;
}
{% endstylesheet %}

{% schema %}
{
  "name": "Video",
  "tag": "div",
  "class": "block-video-wrapper",
  "settings": [
    {
      "type": "video",
      "id": "video",
      "label": "Video",
      "info": "Upload a video from Settings > Files"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "label": "Or video URL",
      "accept": ["youtube", "vimeo"],
      "info": "YouTube or Vimeo URL (used if no uploaded video)"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "Cover image",
      "info": "Poster/thumbnail for the video"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "options": [
        { "value": "16/9", "label": "Widescreen (16:9)" },
        { "value": "4/3", "label": "Standard (4:3)" },
        { "value": "1/1", "label": "Square (1:1)" },
        { "value": "9/16", "label": "Vertical (9:16)" }
      ],
      "default": "16/9"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 32,
      "step": 4,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": false,
      "info": "Videos will be muted when autoplay is enabled"
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_controls",
      "label": "Show controls",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Video",
      "settings": {
        "aspect_ratio": "16/9"
      }
    },
    {
      "name": "Background video",
      "settings": {
        "aspect_ratio": "16/9",
        "autoplay": true,
        "loop": true,
        "show_controls": false
      }
    }
  ]
}
{% endschema %}
